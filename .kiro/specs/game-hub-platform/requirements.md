# 需求文档 - 小游戏集平台

## 简介

本文档定义了小游戏集平台的需求规范。该平台是一个苹果风格的游戏集合系统，采用插件化架构，支持多种小游戏（五子棋、极速狂飙、斗地主等）。每个游戏支持人机对战、双人本地对战和联网对战三种模式。

## 术语表

- **平台系统**: 整个游戏集应用，包括主页、游戏插件、后端服务
- **游戏插件**: 独立的游戏模块，遵循统一接口规范
- **房间**: 联网对战的游戏会话单位
- **玩家**: 参与游戏的真人用户
- **AI对手**: 人机模式下的电脑玩家
- **观战者**: 只观看不参与游戏的用户
- **游戏管理器**: 后端管理所有游戏房间的组件
- **WebSocket**: 实时双向通信协议
- **本地对战**: 同一设备上的双人游戏模式
- **联网对战**: 通过网络连接的多人游戏模式

## 需求

### 需求 1: 平台主页

**用户故事:** 作为玩家，我希望看到清晰的游戏列表，以便我可以选择想玩的游戏。

#### 验收标准

1. THE 平台系统 SHALL 在主页显示所有可用游戏的卡片
2. WHEN 显示游戏卡片时，THE 平台系统 SHALL 包含游戏名称、图标和简介
3. WHEN 玩家点击游戏卡片时，THE 平台系统 SHALL 导航到对应游戏页面
4. THE 平台系统 SHALL 使用苹果风格设计（圆角、毛玻璃、渐变背景）
5. WHEN 玩家悬停在卡片上时，THE 平台系统 SHALL 显示抬升动画效果
6. THE 平台系统 SHALL 自动扫描并加载所有包含game.json的游戏插件

### 需求 2: 游戏插件架构

**用户故事:** 作为开发者，我希望能轻松添加新游戏，以便扩展平台功能。

#### 验收标准

1. THE 平台系统 SHALL 定义标准的游戏插件接口规范
2. WHEN 创建新游戏时，THE 平台系统 SHALL 要求提供game.json配置文件
3. THE 平台系统 SHALL 支持游戏插件包含前端文件（HTML/CSS/JS）
4. THE 平台系统 SHALL 支持游戏插件可选地包含后端服务
5. WHEN 加载游戏插件时，THE 平台系统 SHALL 验证配置文件格式
6. THE 平台系统 SHALL 为每个游戏插件提供独立的命名空间

### 需求 3: 游戏模式选择

**用户故事:** 作为玩家，我希望选择不同的游戏模式，以便根据情况选择合适的玩法。

#### 验收标准

1. WHEN 进入游戏页面时，THE 平台系统 SHALL 显示三种模式选项：人机对战、本地对战、联网对战
2. WHEN 玩家选择人机对战时，THE 平台系统 SHALL 启动单人游戏并加载AI对手
3. WHEN 玩家选择本地对战时，THE 平台系统 SHALL 启动双人轮流游戏
4. WHEN 玩家选择联网对战时，THE 平台系统 SHALL 显示创建房间或加入房间选项
5. THE 平台系统 SHALL 为每种模式提供清晰的图标和说明

### 需求 4: 联网对战 - 房间管理

**用户故事:** 作为玩家，我希望创建或加入游戏房间，以便与其他玩家联网对战。

#### 验收标准

1. WHEN 玩家选择创建房间时，THE 游戏管理器 SHALL 生成唯一的8位房间ID
2. WHEN 房间创建后，THE 游戏管理器 SHALL 将创建者加入房间
3. WHEN 玩家输入房间ID时，THE 游戏管理器 SHALL 验证房间是否存在
4. WHEN 房间存在且未满时，THE 游戏管理器 SHALL 允许玩家加入
5. WHEN 房间人数达到上限时，THE 游戏管理器 SHALL 拒绝新玩家加入
6. WHEN 房间内所有玩家就绪时，THE 游戏管理器 SHALL 启动游戏
7. WHEN 玩家断开连接时，THE 游戏管理器 SHALL 通知其他玩家并清理房间

### 需求 5: 联网对战 - 实时通信

**用户故事:** 作为玩家，我希望游戏操作能实时同步，以便流畅地进行联网对战。

#### 验收标准

1. THE 平台系统 SHALL 使用WebSocket协议进行实时通信
2. WHEN 玩家执行游戏操作时，THE 平台系统 SHALL 立即发送到服务器
3. WHEN 服务器收到操作时，THE 平台系统 SHALL 广播给房间内所有玩家
4. WHEN 接收到其他玩家操作时，THE 平台系统 SHALL 更新本地游戏状态
5. THE 平台系统 SHALL 在网络延迟超过3秒时显示连接状态提示
6. WHEN 连接断开时，THE 平台系统 SHALL 尝试自动重连

### 需求 6: 观战功能

**用户故事:** 作为观众，我希望观看他人对局，以便学习和娱乐。

#### 验收标准

1. WHEN 玩家选择观战模式时，THE 游戏管理器 SHALL 允许加入已有房间作为观战者
2. WHEN 观战者加入时，THE 游戏管理器 SHALL 同步当前游戏状态
3. WHEN 游戏状态更新时，THE 平台系统 SHALL 实时推送给所有观战者
4. THE 平台系统 SHALL 阻止观战者执行游戏操作
5. THE 平台系统 SHALL 允许观战者发送弹幕评论
6. WHEN 观战者发送弹幕时，THE 平台系统 SHALL 广播给房间内所有人

### 需求 7: 统一UI风格

**用户故事:** 作为玩家，我希望所有游戏有一致的视觉风格，以便获得统一的体验。

#### 验收标准

1. THE 平台系统 SHALL 为所有游戏定义统一的CSS样式规范
2. THE 平台系统 SHALL 使用黑色渐变背景（#1d1d1f到#000）
3. THE 平台系统 SHALL 使用浅色文字（#f5f5f7）和灰色次要文字（#86868b）
4. THE 平台系统 SHALL 在所有按钮和卡片上应用圆角和半透明效果
5. THE 平台系统 SHALL 使用苹方或系统字体
6. THE 平台系统 SHALL 为所有交互元素提供悬停和激活状态
7. THE 平台系统 SHALL 使用流畅的CSS过渡动画（0.3秒）

### 需求 8: ESC快速隐藏

**用户故事:** 作为玩家，我希望按ESC键快速隐藏游戏，以便在工作时使用。

#### 验收标准

1. WHEN 玩家按下ESC键时，THE 平台系统 SHALL 隐藏游戏主要元素
2. WHEN 游戏隐藏时，THE 平台系统 SHALL 保持游戏状态不变
3. WHEN 玩家再次按ESC键时，THE 平台系统 SHALL 恢复显示游戏
4. THE 平台系统 SHALL 使用opacity和pointer-events实现隐藏效果
5. THE 平台系统 SHALL 在所有游戏页面实现此功能
6. THE 平台系统 SHALL 在页面底部显示"按ESC隐藏"提示

### 需求 9: 后端服务架构

**用户故事:** 作为系统管理员，我希望后端服务稳定可靠，以便支持多人联网游戏。

#### 验收标准

1. THE 平台系统 SHALL 使用Flask框架提供HTTP服务
2. THE 平台系统 SHALL 使用Flask-SocketIO提供WebSocket服务
3. THE 平台系统 SHALL 通过环境变量配置服务器参数
4. THE 平台系统 SHALL 支持CORS跨域配置
5. THE 平台系统 SHALL 提供静态文件服务
6. WHEN 启动服务器时，THE 平台系统 SHALL 自动加载所有游戏插件
7. THE 平台系统 SHALL 为每个游戏插件提供独立的事件命名空间

### 需求 10: 数据持久化（可选）

**用户故事:** 作为玩家，我希望游戏记录被保存，以便回顾历史对局。

#### 验收标准

1. THE 平台系统 SHALL 支持可选的MySQL数据库连接
2. WHEN 数据库配置正确时，THE 平台系统 SHALL 保存游戏记录
3. WHEN 数据库连接失败时，THE 平台系统 SHALL 继续运行但跳过数据库功能
4. THE 平台系统 SHALL 为每个游戏插件提供独立的数据表
5. WHEN 游戏结束时，THE 平台系统 SHALL 保存对局数据（走法、胜者、时间）
6. THE 平台系统 SHALL 使用连接池管理数据库连接

### 需求 11: 输入验证和安全

**用户故事:** 作为系统管理员，我希望系统能防御恶意输入，以便保护服务器安全。

#### 验收标准

1. THE 平台系统 SHALL 验证所有客户端输入
2. WHEN 验证房间ID时，THE 平台系统 SHALL 检查格式和长度
3. WHEN 验证坐标时，THE 平台系统 SHALL 检查范围和类型
4. WHEN 验证弹幕内容时，THE 平台系统 SHALL 过滤HTML标签和特殊字符
5. WHEN 输入无效时，THE 平台系统 SHALL 返回错误消息而不是崩溃
6. THE 平台系统 SHALL 限制弹幕长度不超过200字符
7. THE 平台系统 SHALL 在生产环境强制配置ALLOWED_ORIGINS

### 需求 12: 五子棋游戏规则

**用户故事:** 作为玩家，我希望玩标准的五子棋游戏，以便享受经典玩法。

#### 验收标准

1. THE 平台系统 SHALL 提供15x15的棋盘
2. WHEN 玩家点击空位时，THE 平台系统 SHALL 放置对应颜色的棋子
3. WHEN 轮到玩家时，THE 平台系统 SHALL 允许其落子
4. WHEN 不是玩家回合时，THE 平台系统 SHALL 阻止落子
5. WHEN 形成五连时，THE 平台系统 SHALL 判定获胜并结束游戏
6. THE 平台系统 SHALL 检查横、竖、斜四个方向的五连
7. WHEN 游戏结束时，THE 平台系统 SHALL 显示获胜者

### 需求 13: 斗地主游戏规则

**用户故事:** 作为玩家，我希望玩标准的斗地主游戏，以便享受经典玩法。

#### 验收标准

1. THE 平台系统 SHALL 使用54张牌（52张+2张王）
2. WHEN 游戏开始时，THE 平台系统 SHALL 给每位玩家发17张牌并留3张底牌
3. WHEN 叫牌阶段时，THE 平台系统 SHALL 允许玩家叫1分、2分、3分或不叫
4. WHEN 确定地主后，THE 平台系统 SHALL 将底牌给地主
5. WHEN 玩家出牌时，THE 平台系统 SHALL 验证牌型是否合法
6. THE 平台系统 SHALL 识别单牌、对子、三张、顺子、炸弹、火箭等牌型
7. WHEN 玩家出完所有牌时，THE 平台系统 SHALL 结束游戏并计算得分

### 需求 14: 极速狂飙游戏规则

**用户故事:** 作为玩家，我希望玩跑酷类游戏，以便享受刺激的闯关体验。

#### 验收标准

1. THE 平台系统 SHALL 提供自动前进的赛车
2. WHEN 玩家按键时，THE 平台系统 SHALL 控制赛车左右移动或跳跃
3. THE 平台系统 SHALL 随机生成障碍物
4. WHEN 赛车碰到障碍物时，THE 平台系统 SHALL 结束游戏
5. THE 平台系统 SHALL 实时显示当前分数
6. WHEN 游戏时间增加时，THE 平台系统 SHALL 提高游戏速度
7. WHEN 游戏结束时，THE 平台系统 SHALL 显示最终得分
